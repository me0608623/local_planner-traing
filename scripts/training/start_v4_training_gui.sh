#!/bin/bash

# ============================================================
# 🎮 v4 訓練啟動腳本（GUI 可視化版本）
# ============================================================
# 版本: v4 (方案 A - 平衡正負獎勵)
# 日期: 2025-10-30
# 模式: GUI 模式（可視化訓練過程）
# ============================================================

echo ""
echo "╔════════════════════════════════════════════════════════════╗"
echo "║                                                            ║"
echo "║       🎮 Nova Carter Navigation v4 訓練（GUI 版）          ║"
echo "║                                                            ║"
echo "╚════════════════════════════════════════════════════════════╝"
echo ""

# 設定 WandB API Key
export WANDB_API_KEY="015e82155dc7cecb79368e0415eaf09362c260ef"
echo "✅ WandB API Key 已設定"
echo ""

# 顯示配置
echo "📊 訓練配置："
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
echo "  任務名稱      │ Isaac-Navigation-LocalPlanner-Min-v0"
echo "  顯示模式      │ 🎮 GUI 可視化（Isaac Sim 視窗）"
echo "  並行環境數    │ 24"
echo "  訓練迭代數    │ 10000"
echo "  記錄工具      │ WandB + 即時畫面"
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
echo ""

echo "👁️  GUI 視窗說明："
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
echo "  • Isaac Sim 視窗將在啟動後開啟"
echo "  • 可看到 24 個 Nova Carter 機器人同時訓練"
echo "  • 綠色球體 = 目標點"
echo "  • 機器人會嘗試導航到目標點"
echo "  • 視窗控制："
echo "    - 滑鼠左鍵拖曳：旋轉視角"
echo "    - 滑鼠滾輪：縮放"
echo "    - 滑鼠中鍵拖曳：平移視角"
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
echo ""

echo "⚠️  注意事項："
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
echo "  • GUI 模式較耗資源，訓練速度會稍慢"
echo "  • 如需最快速度，請使用 ./start_v4_training.sh（無頭模式）"
echo "  • 可隨時按 Ctrl+C 停止訓練"
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
echo ""

echo "🎯 v4 核心調整："
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
echo "  • standstill: 4.0 → 1.0   (↓75%)"
echo "  • anti_idle:  2.0 → 0.5   (↓75%)"
echo "  • progress:   60.0 (保持強力驅動)"
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
echo ""

echo "🚀 正在啟動 Isaac Sim（GUI 模式）..."
echo ""
echo "════════════════════════════════════════════════════════════"
echo ""

# 啟動訓練（GUI 模式 - 移除 --headless）
cd /home/aa/IsaacLab
./isaaclab.sh -p scripts/reinforcement_learning/rsl_rl/train.py \
    --task Isaac-Navigation-LocalPlanner-Min-v0 \
    --num_envs 24 \
    --max_iterations 10000

