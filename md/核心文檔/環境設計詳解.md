# ğŸŒ ç’°å¢ƒè¨­è¨ˆè©³è§£

> **Environment Design** - Nova Carter è¨“ç·´ç’°å¢ƒçš„å®Œæ•´æ¶æ§‹

---

## ğŸ“‹ ç›®éŒ„

1. [å ´æ™¯çµ„æˆ](#å ´æ™¯çµ„æˆ)
2. [ç’°å¢ƒåˆå§‹åŒ–](#ç’°å¢ƒåˆå§‹åŒ–)
3. [Episode æµç¨‹](#episode-æµç¨‹)
4. [é‡ç½®é‚è¼¯](#é‡ç½®é‚è¼¯)
5. [çµ‚æ­¢æ¢ä»¶](#çµ‚æ­¢æ¢ä»¶)
6. [ç‰©ç†è¨­ç½®](#ç‰©ç†è¨­ç½®)
7. [ä¸¦è¡Œç’°å¢ƒ](#ä¸¦è¡Œç’°å¢ƒ)

---

## ğŸ¬ å ´æ™¯çµ„æˆ

### å ´æ™¯æ¶æ§‹ï¼ˆLocalPlannerSceneCfgMinï¼‰

```python
@configclass
class LocalPlannerSceneCfgMin(InteractiveSceneCfg):
    """æœ€å°å ´æ™¯ï¼šåœ°é¢ + æ©Ÿå™¨äºº + LiDAR + ç›®æ¨™æ¨™è¨˜"""
```

---

### 1ï¸âƒ£ åœ°é¢ï¼ˆTerrainï¼‰

**é¡å‹**ï¼šå¹³é¢åœ°æ¿ï¼ˆPlaneï¼‰

**é…ç½®**ï¼š
```python
terrain = TerrainImporterCfg(
    prim_path="/World/ground",
    terrain_type="plane",           # å¹³é¢
    terrain_generator=None,         # ä¸ç”Ÿæˆè¤‡é›œåœ°å½¢
    max_init_terrain_level=0,
    collision_group=-1,             # ç¢°æ’çµ„
    physics_material=RigidBodyMaterialCfg(
        friction_combine_mode="multiply",
        restitution_combine_mode="multiply",
        static_friction=1.0,        # éœæ‘©æ“¦ä¿‚æ•¸
        dynamic_friction=1.0,       # å‹•æ‘©æ“¦ä¿‚æ•¸
    ),
    debug_vis=False,
)
```

**ç‰©ç†å±¬æ€§**ï¼š
- **å¤§å°**ï¼šç„¡é™å¤§å¹³é¢
- **é«˜åº¦**ï¼šZ = 0
- **æ‘©æ“¦**ï¼šé«˜æ‘©æ“¦ï¼ˆé˜²æ­¢æ‰“æ»‘ï¼‰
- **å½ˆæ€§**ï¼šç„¡å½ˆæ€§
- **ç¢°æ’**ï¼šå•Ÿç”¨ï¼ˆLiDAR å¯åµæ¸¬ï¼‰

---

### 2ï¸âƒ£ æ©Ÿå™¨äººï¼ˆNova Carterï¼‰

**æ¨¡å‹**ï¼šNVIDIA Nova Carter USD

**é…ç½®**ï¼š
```python
robot = ArticulationCfg(
    prim_path="{ENV_REGEX_NS}/Robot",  # æ¯å€‹ç’°å¢ƒæœ‰è‡ªå·±çš„æ©Ÿå™¨äºº
    spawn=UsdFileCfg(
        usd_path="/home/aa/isaacsim/usd/nova_carter.usd",
        activate_contact_sensors=False,  # ä¸å•Ÿç”¨æ¥è§¸æ„Ÿæ¸¬å™¨
    ),
    init_state=ArticulationCfg.InitialStateCfg(
        pos=(0.0, 0.0, 0.0),            # åˆå§‹ä½ç½®ï¼ˆä¸–ç•Œåº§æ¨™ï¼‰
        rot=(1.0, 0.0, 0.0, 0.0),       # åˆå§‹æ–¹å‘ï¼ˆå››å…ƒæ•¸ï¼Œæœå‘ +Xï¼‰
    ),
    actuators={
        "base": ImplicitActuatorCfg(
            joint_names_expr=["joint_wheel_left", "joint_wheel_right"],
            velocity_limit=100.0,        # é€Ÿåº¦é™åˆ¶ï¼ˆrad/sï¼‰
            effort_limit=1000.0,         # åŠ›çŸ©é™åˆ¶ï¼ˆNÂ·mï¼‰
            stiffness=0.0,               # å‰›åº¦ï¼ˆé€Ÿåº¦æ§åˆ¶ç”¨ 0ï¼‰
            damping=10000.0,             # é˜»å°¼ï¼ˆé«˜é˜»å°¼ç©©å®šæ§åˆ¶ï¼‰
        ),
    },
)
```

**ç‰©ç†ç‰¹æ€§**ï¼š
- **è¼ªè·**ï¼š0.413 m
- **è¼ªåŠå¾‘**ï¼š0.125 m
- **è³ªé‡**ï¼š~50 kgï¼ˆUSD æ¨¡å‹å®šç¾©ï¼‰
- **é©…å‹•**ï¼šå·®é€Ÿé©…å‹•ï¼ˆå…©è¼ªç¨ç«‹æ§åˆ¶ï¼‰
- **æ§åˆ¶æ¨¡å¼**ï¼šé€Ÿåº¦æ§åˆ¶ï¼ˆVelocity Controlï¼‰

**USD æ¨¡å‹çµæ§‹**ï¼š
```
nova_carter.usd
â”œâ”€â”€ Robot (root)
â”‚   â”œâ”€â”€ chassis_link (æ©Ÿèº«)
â”‚   â”‚   â”œâ”€â”€ base_link (LiDAR å®‰è£ä½ç½®)
â”‚   â”‚   â”œâ”€â”€ lidar_mount
â”‚   â”‚   â””â”€â”€ ... (å…¶ä»–éˆæ¥)
â”‚   â”œâ”€â”€ joint_wheel_left (å·¦è¼ªé—œç¯€)
â”‚   â””â”€â”€ joint_wheel_right (å³è¼ªé—œç¯€)
```

---

### 3ï¸âƒ£ LiDAR æ„Ÿæ¸¬å™¨

**é¡å‹**ï¼š2D é›·å°„æƒæå™¨ï¼ˆæ¨¡æ“¬ Velodyneï¼‰

**é…ç½®**ï¼š
```python
lidar = RayCasterCfg(
    prim_path="/World/envs/.*/Robot/Robot/chassis_link/base_link",
    mesh_prim_paths=["/World/ground"],  # åµæ¸¬åœ°é¢
    pattern_cfg=patterns.LidarPatternCfg(
        channels=1,                      # å–®å±¤ 2D
        vertical_fov_range=(0.0, 0.0),  # æ°´å¹³æƒæ
        horizontal_fov_range=(-180.0, 180.0),  # 360Â° æƒæ
        horizontal_res=1.0,              # æ¯ 1Â° ä¸€æ¢å°„ç·š
    ),
    max_distance=10.0,                   # æœ€å¤§æ¢æ¸¬è·é›¢ 10m
    drift_range=(0.0, 0.0),             # ç„¡æ¼‚ç§»
    debug_vis=False,                     # ä¸é¡¯ç¤ºèª¿è©¦ç·š
)
```

**æƒææ¨¡å¼**ï¼š
```
360Â° æƒæç¤ºæ„åœ–ï¼š
         0Â°
         â†‘
         |
  90Â° â†  +  â†’ -90Â° (270Â°)
         |
         â†“
       Â±180Â°

å°„ç·šæ•¸é‡ï¼š360 æ¢
æƒæé »ç‡ï¼š50 Hzï¼ˆç’°å¢ƒæ§åˆ¶é »ç‡ï¼‰
åµæ¸¬ç¯„åœï¼š0.01m ~ 10m
```

**åµæ¸¬ç›®æ¨™**ï¼š
- âœ… åœ°é¢é‚Šç•Œï¼ˆå¦‚æœæœ‰ï¼‰
- âœ… å…¶ä»–æ©Ÿå™¨äººï¼ˆå¦‚æœå¤ªè¿‘ï¼‰
- âŒ ç„¡å…¶ä»–éšœç¤™ç‰©ï¼ˆæœ€å°å ´æ™¯ï¼‰

---

### 4ï¸âƒ£ å…‰ç…§ï¼ˆDome Lightï¼‰

**é…ç½®**ï¼š
```python
dome_light = AssetBaseCfg(
    prim_path="/World/DomeLight",
    spawn=DomeLightCfg(
        color=(0.9, 0.9, 0.9),  # ç™½è‰²
        intensity=500.0,         # äº®åº¦
    ),
)
```

**ä½œç”¨**ï¼š
- æä¾›å‡å‹»å…‰ç…§
- GUI æ¨¡å¼æ™‚å¯è¦–åŒ–
- ä¸å½±éŸ¿è¨“ç·´ï¼ˆç„¡é ­æ¨¡å¼ç„¡å…‰ç…§ï¼‰

---

### 5ï¸âƒ£ ç›®æ¨™æ¨™è¨˜ï¼ˆGoal Markerï¼‰

**å¯è¦–åŒ–**ï¼šç¶ è‰²çƒé«”ï¼ˆDebug æ¨¡å¼ï¼‰

**é…ç½®**ï¼š
```python
goal_command = UniformPoseCommandCfg(
    asset_name="robot",
    body_name="chassis_link",
    resampling_time_range=(10.0, 10.0),  # æ¯ 10 ç§’é‡æ–°ç”Ÿæˆ
    debug_vis=True,                       # é¡¯ç¤ºç¶ è‰²çƒé«”
    ranges=Ranges(
        pos_x=(2.0, 6.0),                # X ç¯„åœ
        pos_y=(-3.0, 3.0),               # Y ç¯„åœ
        pos_z=(0.0, 0.0),                # Z å›ºå®šç‚º 0
        roll=(0.0, 0.0),
        pitch=(0.0, 0.0),
        yaw=(0.0, 0.0),
    ),
)
```

**ç”Ÿæˆé‚è¼¯**ï¼š
```python
# éš¨æ©Ÿç”Ÿæˆç›®æ¨™ä½ç½®ï¼ˆä¸–ç•Œåº§æ¨™ï¼‰
goal_x = robot_x + uniform(2.0, 6.0)  # å‰æ–¹ 2-6m
goal_y = robot_y + uniform(-3.0, 3.0) # å·¦å³ -3-3m
goal_z = 0.0                           # åœ°é¢é«˜åº¦
```

---

## ğŸ”„ ç’°å¢ƒåˆå§‹åŒ–

### åˆå§‹åŒ–æµç¨‹

```
1. å‰µå»ºå ´æ™¯ (Scene Creation)
   â”œâ”€ è¼‰å…¥ USD è³‡ç”¢ï¼ˆNova Carterï¼‰
   â”œâ”€ è¨­ç½®ç‰©ç†æè³ªï¼ˆåœ°é¢æ‘©æ“¦ï¼‰
   â”œâ”€ åˆå§‹åŒ–æ„Ÿæ¸¬å™¨ï¼ˆLiDARï¼‰
   â””â”€ é…ç½®å…‰ç…§

2. è¤‡è£½ç’°å¢ƒ (Environment Cloning)
   â”œâ”€ æ ¹æ“š num_envs å‰µå»ºå¤šå€‹å‰¯æœ¬
   â”œâ”€ æ¯å€‹ç’°å¢ƒé–“éš” env_spacing
   â””â”€ åˆ†é…ç¨ç«‹çš„å‘½åç©ºé–“

3. åˆå§‹åŒ–ç®¡ç†å™¨ (Manager Initialization)
   â”œâ”€ ObservationManagerï¼ˆè§€æ¸¬ï¼‰
   â”œâ”€ ActionManagerï¼ˆå‹•ä½œï¼‰
   â”œâ”€ CommandManagerï¼ˆç›®æ¨™ï¼‰
   â”œâ”€ RewardManagerï¼ˆçå‹µï¼‰
   â””â”€ TerminationManagerï¼ˆçµ‚æ­¢ï¼‰

4. é¦–æ¬¡é‡ç½® (Initial Reset)
   â”œâ”€ æ©Ÿå™¨äººå›åˆ°åˆå§‹ä½ç½®
   â”œâ”€ ç”Ÿæˆé¦–å€‹ç›®æ¨™
   â””â”€ é‡ç½®æ‰€æœ‰ç·©è¡å€
```

---

### ç’°å¢ƒåƒæ•¸

```python
@configclass
class LocalPlannerEnvCfgMin(ManagerBasedRLEnvCfg):
    # å ´æ™¯è¨­ç½®
    scene = LocalPlannerSceneCfgMin(
        num_envs=24,             # ä¸¦è¡Œç’°å¢ƒæ•¸ï¼ˆGPU è¨“ç·´ï¼‰
        env_spacing=10.0,        # ç’°å¢ƒé–“éš” 10m
    )
    
    # æ™‚é–“è¨­ç½®
    decimation = 2               # æ§åˆ¶é »ç‡ä¸‹æ¡æ¨£
    episode_length_s = 30.0      # Episode é•·åº¦ 30 ç§’
    
    # æ¨¡æ“¬è¨­ç½®
    sim.dt = 0.01                # ç‰©ç†æ™‚é–“æ­¥ 0.01sï¼ˆ100 Hzï¼‰
    sim.render_interval = 2      # æ¸²æŸ“é–“éš”ï¼ˆ= decimationï¼‰
    sim.device = "cuda:0"        # æ¨¡æ“¬è¨­å‚™
    
    # ç›¸æ©Ÿè¨­ç½®ï¼ˆGUI æ¨¡å¼ï¼‰
    viewer.eye = (10.0, 10.0, 10.0)    # ç›¸æ©Ÿä½ç½®
    viewer.lookat = (0.0, 0.0, 0.0)    # è§€å¯Ÿé»
```

---

### æ™‚é–“è¨ˆç®—

```
ç‰©ç†é »ç‡ï¼š1 / dt = 1 / 0.01 = 100 Hz
æ§åˆ¶é »ç‡ï¼šç‰©ç†é »ç‡ / decimation = 100 / 2 = 50 Hz
Episode æ­¥æ•¸ï¼šepisode_length_s / (dt Ã— decimation) = 30 / 0.02 = 1500 æ­¥

æ¯æ­¥æ™‚é•·ï¼šdt Ã— decimation = 0.01 Ã— 2 = 0.02s
æ¯ç§’æ­¥æ•¸ï¼š50 æ­¥
```

---

## ğŸ® Episode æµç¨‹

### å®Œæ•´ Episode æ™‚åºåœ–

```
Episode é–‹å§‹ï¼ˆt=0ï¼‰
  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Resetï¼ˆé‡ç½®ï¼‰                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1. æ©Ÿå™¨äººä½ç½® â†’ (0, 0, 0)              â”‚
â”‚ 2. æ©Ÿå™¨äººé€Ÿåº¦ â†’ (0, 0, 0)              â”‚
â”‚ 3. ç”Ÿæˆæ–°ç›®æ¨™ï¼ˆéš¨æ©Ÿä½ç½®ï¼‰                â”‚
â”‚ 4. é‡ç½®è§€æ¸¬ç·©è¡                         â”‚
â”‚ 5. é‡ç½®çå‹µç·©è¡                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 1 (t = 0.02s)                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1. ç²å–è§€æ¸¬ â†’ state                     â”‚
â”‚ 2. Agent æ±ºç­– â†’ action                  â”‚
â”‚ 3. åŸ·è¡Œå‹•ä½œï¼ˆ2 å€‹ç‰©ç†æ­¥ï¼‰                â”‚
â”‚ 4. è¨ˆç®—çå‹µ â†’ reward                    â”‚
â”‚ 5. æª¢æŸ¥çµ‚æ­¢ â†’ done                      â”‚
â”‚ 6. å„²å­˜ç¶“é©— (s, a, r, s')              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 2 (t = 0.04s)                      â”‚
â”‚ ...                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â†“
  ... (é‡è¤‡ 1500 æ­¥æˆ–æå‰çµ‚æ­¢)
  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Episode çµæŸ                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ åŸå› ï¼š                                  â”‚
â”‚  â€¢ åˆ°é”ç›®æ¨™ï¼ˆdone = Trueï¼‰              â”‚
â”‚  â€¢ è¶…æ™‚ï¼ˆ1500 æ­¥ï¼Œdone = Trueï¼‰         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â†“
è‡ªå‹• Resetï¼Œé–‹å§‹æ–° Episode
```

---

### å–®æ­¥åŸ·è¡Œç´°ç¯€

```python
# env.step(action) çš„å…§éƒ¨æµç¨‹

def step(self, action):
    # 1. å‹•ä½œè™•ç†
    self.action_manager.process_action(action)
    # è½‰æ›ç‚ºè¼ªå­é€Ÿåº¦æŒ‡ä»¤
    
    # 2. åŸ·è¡Œç‰©ç†æ¨¡æ“¬ï¼ˆdecimation æ­¥ï¼‰
    for _ in range(self.decimation):
        self.sim.step()  # 0.01s ç‰©ç†æ­¥
    # ç¸½å…± 0.02s
    
    # 3. æ›´æ–°æ„Ÿæ¸¬å™¨
    self.scene.update(self.sim.dt * self.decimation)
    # LiDAR æƒæã€æ©Ÿå™¨äººç‹€æ…‹
    
    # 4. è¨ˆç®—è§€æ¸¬
    obs = self.observation_manager.compute()
    # LiDAR + é€Ÿåº¦ + ç›®æ¨™è³‡è¨Š
    
    # 5. è¨ˆç®—çå‹µ
    reward = self.reward_manager.compute(dt=self.step_dt)
    # 8 é …çå‹µç¸½å’Œ
    
    # 6. æª¢æŸ¥çµ‚æ­¢
    done = self.termination_manager.compute()
    # åˆ°é”ç›®æ¨™æˆ–è¶…æ™‚
    
    # 7. æ›´æ–°è¨ˆæ•¸å™¨
    self.episode_length_buf += 1
    
    # 8. è‡ªå‹•é‡ç½®ï¼ˆå¦‚æœ doneï¼‰
    if done.any():
        self._reset_idx(done.nonzero())
    
    return obs, reward, done, info
```

---

## ğŸ”„ é‡ç½®é‚è¼¯

### Reset è§¸ç™¼æ¢ä»¶

1. **Episode é–‹å§‹**ï¼šé¦–æ¬¡èª¿ç”¨ `env.reset()`
2. **åˆ°é”ç›®æ¨™**ï¼š`goal_reached == True`
3. **è¶…æ™‚**ï¼š`episode_length >= 1500`
4. **æ‰‹å‹•é‡ç½®**ï¼šèª¿ç”¨ `env.reset()`

---

### Reset åŸ·è¡Œæµç¨‹

```python
def _reset_idx(self, env_ids):
    """é‡ç½®æŒ‡å®šç’°å¢ƒ"""
    
    # 1. é‡ç½®æ©Ÿå™¨äººç‹€æ…‹
    self.robot.write_root_pose_to_sim(
        root_pose=default_root_state[env_ids],  # (0, 0, 0)
        env_ids=env_ids,
    )
    self.robot.write_root_velocity_to_sim(
        root_velocity=torch.zeros_like(...),    # é€Ÿåº¦æ­¸é›¶
        env_ids=env_ids,
    )
    
    # 2. é‡ç½®é—œç¯€ç‹€æ…‹
    self.robot.write_joint_state_to_sim(
        joint_pos=default_joint_pos[env_ids],
        joint_vel=default_joint_vel[env_ids],
        env_ids=env_ids,
    )
    
    # 3. é‡æ–°ç”Ÿæˆç›®æ¨™
    self.command_manager.reset(env_ids=env_ids)
    # éš¨æ©Ÿé¸æ“‡æ–°çš„ç›®æ¨™ä½ç½®
    
    # 4. é‡ç½®ç®¡ç†å™¨ç·©è¡
    self.observation_manager.reset(env_ids=env_ids)
    self.reward_manager.reset(env_ids=env_ids)
    self.termination_manager.reset(env_ids=env_ids)
    
    # 5. é‡ç½® Episode è¨ˆæ•¸
    self.episode_length_buf[env_ids] = 0
    
    # 6. æ¸…é™¤æ­·å²æ•¸æ“š
    if hasattr(self, '_prev_goal_distance'):
        self._prev_goal_distance[env_ids] = ...
```

---

### Reset å¾Œçš„ç‹€æ…‹

```python
æ©Ÿå™¨äººï¼š
  ä½ç½®ï¼š(0.0, 0.0, 0.0)
  æ–¹å‘ï¼š(1.0, 0.0, 0.0, 0.0)  # æœå‘ +X
  é€Ÿåº¦ï¼š(0.0, 0.0, 0.0)
  è§’é€Ÿåº¦ï¼š(0.0, 0.0, 0.0)

ç›®æ¨™ï¼š
  ä½ç½®ï¼šrandom in [(2, -3), (6, 3)]  # å‰æ–¹ 2-6mï¼Œå·¦å³ -3-3m
  
è§€æ¸¬ï¼š
  LiDARï¼šå…¨ 1.0ï¼ˆç„¡éšœç¤™ç‰©ï¼Œæœ€é è·é›¢ï¼‰
  é€Ÿåº¦ï¼šå…¨ 0
  ç›®æ¨™ç›¸å°ä½ç½®ï¼š(dx, dy)
  ç›®æ¨™è·é›¢ï¼š||goal - robot||
  
çå‹µï¼š
  progressï¼š0ï¼ˆé¦–æ­¥ç„¡æ­·å²ï¼‰
  å…¶ä»–ï¼šæ ¹æ“šåˆå§‹ç‹€æ…‹è¨ˆç®—
```

---

## ğŸ çµ‚æ­¢æ¢ä»¶

### çµ‚æ­¢æª¢æŸ¥ï¼ˆæ¯æ­¥åŸ·è¡Œï¼‰

```python
@configclass
class TerminationsCfg:
    # 1. è¶…æ™‚çµ‚æ­¢
    time_out = DoneTerm(
        func=mdp.time_out,
        time_out=True,  # æ¨™è¨˜ç‚ºè¶…æ™‚
    )
    
    # 2. åˆ°é”ç›®æ¨™çµ‚æ­¢
    goal_reached = DoneTerm(
        func=mdp.goal_reached,
        params={
            "command_name": "goal_command",
            "threshold": 0.8,  # 0.8m å…§ç®—åˆ°é”
        },
    )
```

---

### 1ï¸âƒ£ è¶…æ™‚çµ‚æ­¢ï¼ˆTime Outï¼‰

**æ¢ä»¶**ï¼š
```python
def time_out(env) -> torch.Tensor:
    """æª¢æŸ¥æ˜¯å¦è¶…æ™‚"""
    max_steps = env.max_episode_length  # 1500
    current_steps = env.episode_length_buf
    
    done = (current_steps >= max_steps)
    return done  # shape: (num_envs,)
```

**ç‰©ç†æ„ç¾©**ï¼š
- Episode é•·åº¦ï¼š30 ç§’ï¼ˆ1500 æ­¥ï¼‰
- å¦‚æœ 30 ç§’å…§æœªåˆ°é”ç›®æ¨™ â†’ è¶…æ™‚
- è¶…æ™‚ç‡é«˜ â†’ Agent æ•ˆç‡ä½

---

### 2ï¸âƒ£ åˆ°é”ç›®æ¨™çµ‚æ­¢ï¼ˆGoal Reachedï¼‰

**æ¢ä»¶**ï¼š
```python
def goal_reached(env, command_name, threshold=0.8) -> torch.Tensor:
    """æª¢æŸ¥æ˜¯å¦åˆ°é”ç›®æ¨™"""
    command = env.command_manager.get_command(command_name)
    goal_pos_w = command[:, :3]
    
    robot = env.scene["robot"]
    robot_pos_w = robot.data.root_pos_w
    
    # è¨ˆç®— 2D è·é›¢
    distance = torch.norm(
        goal_pos_w[:, :2] - robot_pos_w[:, :2],
        dim=-1
    )
    
    # è·é›¢ < 0.8m ç®—åˆ°é”
    done = (distance < threshold)
    return done
```

**ç‰©ç†æ„ç¾©**ï¼š
- ç›®æ¨™åŠå¾‘ï¼š0.8m
- é€²å…¥ 0.8m å…§ â†’ æˆåŠŸ
- åŒæ™‚è§¸ç™¼ `reached_goal` çå‹µï¼ˆ+200ï¼‰

---

### çµ‚æ­¢å¾Œçš„è™•ç†

```python
# åœ¨ step() ä¸­

done = self.termination_manager.compute()
# shape: (num_envs,) å¸ƒæ—å€¼

if done.any():
    # æ‰¾å‡ºéœ€è¦é‡ç½®çš„ç’°å¢ƒ
    env_ids = done.nonzero(as_tuple=False).squeeze(-1)
    
    # é‡ç½®é€™äº›ç’°å¢ƒ
    self._reset_idx(env_ids)
    
    # è¨˜éŒ„çµ±è¨ˆæ•¸æ“š
    self.extras["time_outs"] = time_out_mask[env_ids]
    self.extras["goal_reached"] = goal_reached_mask[env_ids]
```

---

### çµ‚æ­¢çµ±è¨ˆ

**è¨“ç·´æ™‚è¨˜éŒ„**ï¼š
```python
Episode_Termination/time_out: 0.9583      # 95.83% è¶…æ™‚
Episode_Termination/goal_reached: 0.0417  # 4.17% æˆåŠŸ
```

**ç†æƒ³ç‹€æ…‹**ï¼š
```python
Episode_Termination/time_out: 0.0         # 0% è¶…æ™‚
Episode_Termination/goal_reached: 1.0     # 100% æˆåŠŸ
```

---

## âš™ï¸ ç‰©ç†è¨­ç½®

### PhysX é…ç½®

```python
@configclass
class SimCfg:
    # æ™‚é–“æ­¥
    dt = 0.01                    # 0.01s = 100 Hz
    
    # æ¸²æŸ“
    render_interval = 2          # æ¯ 2 å€‹ç‰©ç†æ­¥æ¸²æŸ“ä¸€æ¬¡
    
    # PhysX å¼•æ“
    physx = PhysxCfg(
        solver_type=1,           # TGSï¼ˆTemporal Gauss Seidelï¼‰
        min_position_iteration_count=4,
        max_position_iteration_count=255,
        min_velocity_iteration_count=0,
        max_velocity_iteration_count=255,
        enable_ccd=False,        # é€£çºŒç¢°æ’åµæ¸¬ï¼ˆé—œé–‰ï¼‰
        enable_stabilization=True,
        # GPU ç®¡ç·š
        use_gpu=True,
        gpu_max_rigid_contact_count=2**23,
        gpu_max_rigid_patch_count=2**21,
        gpu_found_lost_pairs_capacity=2**21,
        gpu_found_lost_aggregate_pairs_capacity=2**20,
        gpu_total_aggregate_pairs_capacity=2**20,
        gpu_collision_stack_size=2**26,
    )
```

---

### ç‰©ç†ç‰¹æ€§

**é‡åŠ›**ï¼š
```python
gravity = (0.0, 0.0, -9.81)  # m/sÂ²
```

**æ‘©æ“¦æ¨¡å‹**ï¼š
```python
# åœ°é¢æè³ª
static_friction = 1.0   # éœæ‘©æ“¦ä¿‚æ•¸
dynamic_friction = 1.0  # å‹•æ‘©æ“¦ä¿‚æ•¸
friction_combine_mode = "multiply"

# è¼ªå­èˆ‡åœ°é¢æ‘©æ“¦
# F_friction = Î¼ Ã— N
# è¶³å¤ å¤§é˜²æ­¢æ‰“æ»‘
```

**ç¢°æ’åµæ¸¬**ï¼š
```python
# ç•¶å‰é…ç½®ï¼šç„¡ç¢°æ’çµ‚æ­¢
# LiDAR å¯åµæ¸¬éšœç¤™ç‰©ï¼Œä½†ç¢°æ’ä¸æœƒçµ‚æ­¢ Episode
# æœªä¾†å¯åŠ å…¥ï¼š
collision_penalty = RewTerm(
    func=mdp.collision_penalty,
    weight=-100.0,
)
```

---

### æ•¸å€¼ç©©å®šæ€§

**æ±‚è§£å™¨è¿­ä»£**ï¼š
```python
position_iterations: 4-255  # ä½ç½®ç´„æŸè¿­ä»£
velocity_iterations: 0-255  # é€Ÿåº¦ç´„æŸè¿­ä»£

# æ›´å¤šè¿­ä»£ = æ›´ç©©å®šä½†æ›´æ…¢
# ç•¶å‰è¨­ç½®ï¼šå…è¨±è‡ªé©æ‡‰èª¿æ•´
```

**æ™‚é–“æ­¥é•·**ï¼š
```python
dt = 0.01s  # è¶³å¤ å°ä»¥ä¿è­‰ç©©å®šæ€§

æœ€å¤§é€Ÿåº¦ï¼š0.8 m/s
æœ€å¤§ä½ç§»/æ­¥ï¼š0.8 Ã— 0.01 = 0.008 m = 8 mm
# é å°æ–¼è¼ªåŠå¾‘ï¼ˆ125 mmï¼‰ï¼Œç©©å®š
```

---

## ğŸ”¢ ä¸¦è¡Œç’°å¢ƒ

### ç’°å¢ƒå¸ƒå±€

**24 å€‹ç’°å¢ƒæ’åˆ—**ï¼ˆ6Ã—4 ç¶²æ ¼ï¼‰ï¼š

```
ç’°å¢ƒé–“éš”ï¼š10m

  Env 0   Env 1   Env 2   Env 3   Env 4   Env 5
   ğŸ¤–      ğŸ¤–      ğŸ¤–      ğŸ¤–      ğŸ¤–      ğŸ¤–
   ğŸŸ¢      ğŸŸ¢      ğŸŸ¢      ğŸŸ¢      ğŸŸ¢      ğŸŸ¢

  Env 6   Env 7   Env 8   Env 9   Env 10  Env 11
   ğŸ¤–      ğŸ¤–      ğŸ¤–      ğŸ¤–      ğŸ¤–      ğŸ¤–
   ğŸŸ¢      ğŸŸ¢      ğŸŸ¢      ğŸŸ¢      ğŸŸ¢      ğŸŸ¢

  Env 12  Env 13  Env 14  Env 15  Env 16  Env 17
   ğŸ¤–      ğŸ¤–      ğŸ¤–      ğŸ¤–      ğŸ¤–      ğŸ¤–
   ğŸŸ¢      ğŸŸ¢      ğŸŸ¢      ğŸŸ¢      ğŸŸ¢      ğŸŸ¢

  Env 18  Env 19  Env 20  Env 21  Env 22  Env 23
   ğŸ¤–      ğŸ¤–      ğŸ¤–      ğŸ¤–      ğŸ¤–      ğŸ¤–
   ğŸŸ¢      ğŸŸ¢      ğŸŸ¢      ğŸŸ¢      ğŸŸ¢      ğŸŸ¢

ç¸½å ´æ™¯å¤§å°ï¼šç´„ 60m Ã— 40m
```

---

### ç’°å¢ƒç¨ç«‹æ€§

**æ¯å€‹ç’°å¢ƒç¨ç«‹**ï¼š
```python
# ä½ç½®åç§»
env_origins = torch.tensor([
    [0, 0, 0],      # Env 0
    [10, 0, 0],     # Env 1
    [20, 0, 0],     # Env 2
    ...
], device="cuda")

# æ©Ÿå™¨äººä½ç½® = ç’°å¢ƒåŸé» + å±€éƒ¨ä½ç½®
robot_pos_w[i] = env_origins[i] + robot_pos_local[i]

# ç›®æ¨™ä½ç½® = ç’°å¢ƒåŸé» + å±€éƒ¨ç›®æ¨™
goal_pos_w[i] = env_origins[i] + goal_pos_local[i]
```

**ä¸æœƒäº’ç›¸å¹²æ“¾**ï¼š
- âœ… 10m é–“éš”è¶³å¤ å¤§
- âœ… ç›®æ¨™ç¯„åœï¼šå‰æ–¹ 2-6mï¼Œå·¦å³ -3-3m
- âœ… æœ€å¤§æ´»å‹•ç¯„åœï¼š~7m
- âœ… å®‰å…¨è£•åº¦ï¼š3m

---

### ä¸¦è¡Œæ•ˆç‡

**æ•¸æ“šä¸¦è¡Œ**ï¼š
```python
# æ‰€æœ‰ç’°å¢ƒåŒæ™‚åŸ·è¡Œ
obs = torch.stack([env.obs for env in envs])    # (24, 369)
actions = policy(obs)                            # (24, 2)
rewards = torch.stack([env.reward for env in envs])  # (24,)

# GPU åŠ é€Ÿ
# 24 å€‹ç’°å¢ƒåœ¨å–®å€‹ forward pass è™•ç†
# ç›¸æ¯”å–®ç’°å¢ƒå¿« ~15-20 å€
```

**è¨˜æ†¶é«”ä½¿ç”¨**ï¼š
```python
æ¯å€‹ç’°å¢ƒï¼š
  - æ©Ÿå™¨äººç‹€æ…‹ï¼š~100 KB
  - LiDAR æ•¸æ“šï¼š~10 KB
  - è§€æ¸¬ç·©è¡ï¼š~5 KB
  
24 å€‹ç’°å¢ƒï¼š~3 MBï¼ˆç‹€æ…‹æ•¸æ“šï¼‰
ç¶²è·¯åƒæ•¸ï¼š~1.5 MBï¼ˆActor + Criticï¼‰
ç¸½ GPU è¨˜æ†¶é«”ï¼š~2 GBï¼ˆåŒ…å« Isaac Simï¼‰
```

---

## ğŸ“Š ç’°å¢ƒçµ±è¨ˆ

### é—œéµæŒ‡æ¨™

```python
# æ¯æ¬¡è¨“ç·´è¿­ä»£

æ¨£æœ¬æ•¸ï¼š24 envs Ã— 24 steps = 576 samples
è¨“ç·´æ™‚é–“ï¼š~1.5 ç§’/iterï¼ˆGPUï¼‰
ååé‡ï¼š~384 samples/s

# å®Œæ•´è¨“ç·´

ç¸½è¿­ä»£ï¼š10000 iters
ç¸½æ¨£æœ¬ï¼š10000 Ã— 576 = 5,760,000 samples
è¨“ç·´æ™‚é•·ï¼š10000 Ã— 1.5s â‰ˆ 4.2 å°æ™‚
```

---

### Episode çµ±è¨ˆï¼ˆç›®æ¨™ï¼‰

```python
ç†æƒ³ç‹€æ…‹ï¼š
  - å¹³å‡ Episode é•·åº¦ï¼š~300 æ­¥ï¼ˆ6 ç§’ï¼‰
  - æˆåŠŸç‡ï¼š>80%
  - å¹³å‡çå‹µï¼š>50
  - è¶…æ™‚ç‡ï¼š<20%

ç•¶å‰ç‹€æ…‹ï¼ˆv4 è¨“ç·´ä¸­ï¼‰ï¼š
  - å¹³å‡ Episode é•·åº¦ï¼š1500 æ­¥ï¼ˆ30 ç§’ï¼‰
  - æˆåŠŸç‡ï¼š~0-5%
  - å¹³å‡çå‹µï¼š-10 ~ 0
  - è¶…æ™‚ç‡ï¼š95-100%
```

---

## ğŸ¯ ç’°å¢ƒè¨­è¨ˆç‰¹é»

### âœ… å„ªé»

1. **ç°¡æ½”**ï¼šæœ€å°åŒ–å ´æ™¯ï¼Œèšç„¦å°èˆªä»»å‹™
2. **é«˜æ•ˆ**ï¼š24 ä¸¦è¡Œç’°å¢ƒï¼ŒGPU åŠ é€Ÿ
3. **ç©©å®š**ï¼šé«˜æ‘©æ“¦åœ°é¢ï¼Œç„¡è¤‡é›œç¢°æ’
4. **å¯æ“´å±•**ï¼šæ˜“æ–¼åŠ å…¥éšœç¤™ç‰©ã€å‹•æ…‹ç‰©é«”
5. **å¯è¦–åŒ–**ï¼šæ”¯æŒ GUI æ¨¡å¼è§€å¯Ÿ

### âš ï¸ é™åˆ¶

1. **ç„¡éšœç¤™ç‰©**ï¼šåªæœ‰åœ°é¢ï¼Œç„¡çœŸå¯¦é¿éšœ
2. **å›ºå®šåœ°å½¢**ï¼šå¹³é¢ï¼Œç„¡è¤‡é›œåœ°å½¢
3. **ç„¡å‹•æ…‹**ï¼šç„¡ç§»å‹•éšœç¤™ç‰©
4. **ç›®æ¨™ç°¡å–®**ï¼šéš¨æ©Ÿé»ï¼Œç„¡èªç¾©ç†è§£

---

## ğŸ”® æœªä¾†æ“´å±•

### è¨ˆåŠƒä¸­çš„å¢å¼·

**1. éœæ…‹éšœç¤™ç‰©**ï¼š
```python
obstacles = AssetBaseCfg(
    prim_path="{ENV_REGEX_NS}/Obstacles",
    spawn=UsdFileCfg(
        usd_path="/path/to/obstacles.usd",
    ),
    init_state=AssetInitialStateCfg(
        pos=RandomUniformDistribution(
            min=(-5, -5, 0),
            max=(5, 5, 0),
        ),
    ),
)
```

**2. å‹•æ…‹éšœç¤™ç‰©**ï¼š
```python
dynamic_obstacles = ArticulationCfg(
    # ç§»å‹•çš„ç®±å­
    velocity=RandomUniformDistribution(...),
)
```

**3. è¤‡é›œåœ°å½¢**ï¼š
```python
terrain = TerrainImporterCfg(
    terrain_type="generator",
    terrain_generator=RandomTerrainGeneratorCfg(
        height_range=(0.0, 0.5),  # é«˜ä½èµ·ä¼
        slope_range=(0.0, 0.3),   # æ–œå¡
    ),
)
```

**4. èª²ç¨‹å­¸ç¿’**ï¼š
```python
# é€æ­¥å¢åŠ é›£åº¦
if iteration < 3000:
    goal_range = (2, 4)    # è¿‘è·é›¢
elif iteration < 6000:
    goal_range = (3, 5)    # ä¸­è·é›¢
else:
    goal_range = (4, 6)    # é è·é›¢
```

---

## ğŸ“š ç¸½çµ

### ç’°å¢ƒæ ¸å¿ƒè¨­è¨ˆ

```
å ´æ™¯çµ„æˆï¼š
  âœ… å¹³é¢åœ°é¢ï¼ˆé«˜æ‘©æ“¦ï¼‰
  âœ… Nova Carter æ©Ÿå™¨äººï¼ˆå·®é€Ÿé©…å‹•ï¼‰
  âœ… 360Â° LiDARï¼ˆ10m ç¯„åœï¼‰
  âœ… éš¨æ©Ÿç›®æ¨™é»ï¼ˆ2-6m å‰æ–¹ï¼‰
  âœ… 24 å€‹ä¸¦è¡Œç’°å¢ƒï¼ˆ10m é–“éš”ï¼‰

æ™‚é–“è¨­ç½®ï¼š
  âœ… ç‰©ç†é »ç‡ï¼š100 Hzï¼ˆ0.01sï¼‰
  âœ… æ§åˆ¶é »ç‡ï¼š50 Hzï¼ˆ0.02sï¼‰
  âœ… Episode é•·åº¦ï¼š30sï¼ˆ1500 æ­¥ï¼‰

çµ‚æ­¢æ¢ä»¶ï¼š
  âœ… åˆ°é”ç›®æ¨™ï¼ˆ< 0.8mï¼‰
  âœ… è¶…æ™‚ï¼ˆ1500 æ­¥ï¼‰

é‡ç½®é‚è¼¯ï¼š
  âœ… æ©Ÿå™¨äººå›åˆ°åŸé»
  âœ… é€Ÿåº¦æ­¸é›¶
  âœ… é‡æ–°ç”Ÿæˆç›®æ¨™
```

---

**æŸ¥çœ‹å®Œæ•´æ–‡æª”**ï¼š
```bash
cat /home/aa/IsaacLab/md/æ ¸å¿ƒæ–‡æª”/ç’°å¢ƒè¨­è¨ˆè©³è§£.md
```

**é€™ä»½æ–‡æª”è©³ç´°è§£é‡‹äº†ç’°å¢ƒçš„æ‰€æœ‰è¨­è¨ˆç´°ç¯€ï¼** ğŸŒâœ¨

